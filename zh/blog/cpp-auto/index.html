<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>浅谈C++ auto - 我的川陀</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap">
  <link rel="stylesheet" href="https://huangweiran.club/assets/css/custom.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css"/>
 
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
        onload="renderMathInElement(document.body, {
          delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '\\(', right: '\\)', display: false},
            {left: '$', right: '$', display: false}
          ]
        });"></script><link rel="apple-touch-icon" sizes="180x180" href="https://huangweiran.club/images/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://huangweiran.club/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://huangweiran.club/images/favicon/favicon-16x16.png">
    <link rel="manifest" href="https://huangweiran.club/images/favicon/site.webmanifest">
    <link rel="mask-icon" href="https://huangweiran.club/images/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#2d89ef">
    <meta name="theme-color" content="#ffffff"><link rel="canonical" href="https://huangweiran.club/zh/blog/cpp-auto/" /><link rel="alternate" type="application/atom+xml"
        title="RSS" href="https://huangweiran.club/atom.xml"
      ><meta name="author" content="Weiran Huang"><meta name="description" content="用法和自动类型推导规则的辨析" /><meta property="article:published_time" content='2024-10-23T22:24:00-05:00' /><meta name="generator" content="Zola">
  <meta property="og:title" content="浅谈C++ auto" />
  <meta property="og:url" content="https://huangweiran.club/zh/blog/cpp-auto/" /><meta property="og:description" content="用法和自动类型推导规则的辨析" /><meta property="og:image" content="https://huangweiran.club/images/cpp-history.png" /><meta property="og:site_name" content="我的川陀" />
  <meta property="og:locale" content="en_US" />
  <meta name="twitter:card" content="summary" /><meta name="twitter:creator" content="@user" /><meta name="google-site-verification" content="0123457890abcdefg" />
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CNYGLH4HFP"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-CNYGLH4HFP');
    </script>
</head>
<body>
  <div class="container-fluid vh-100">
    <div class="row h-100"><div
    class="sidebar d-none d-lg-block col-lg-3 col-xl-2 mh-100 p-0 overflow-auto"
  >
    <aside class="d-flex flex-column justify-content-between h-100">
      <div class="d-none d-md-block mb-4 pt-5 px-4 text-center">
        <div class="sidebar-avatar mb-2 mx-auto border border-3 rounded-circle">
          <a href="https://huangweiran.club/" target="_blank" rel="noopener noreferrer">
    <img
      src="https://i.pinimg.com/736x/e7/d3/b6/e7d3b63a28a976d061696af520f80ee8.jpg"
      alt="Weiran Huang"
      class="img-fluid"
    >
  </a>
        </div>
        <div class="mb-1">
          <a
            href="https://huangweiran.club/"
            class="sidebar-title fs-5 fw-bold text-decoration-none"
          >
            我的川陀
          </a>
        </div>
        <div class="fw-light">
          行善，爱慈，谦卑。
        </div>
      </div>

      <div class="sidebar-nav list-group my-auto rounded-0 text-center"><a
            href="https://huangweiran.club/zh/"
            class="sidebar-nav-item list-group-item list-group-item-action border border-0"
            data-bs-toggle="tooltip" data-bs-title="主页"
          >
          <span class="sidebar-nav-icon bi bi-house d-none fs-4"></span>
          <span class="sidebar-nav-text d-none d-md-inline">
            主页
          </span>
          </a><a
            href="https://huangweiran.club/zh/blog/"
            class="sidebar-nav-item list-group-item list-group-item-action border border-0"
            data-bs-toggle="tooltip" data-bs-title="博客"
          >
          <span class="sidebar-nav-icon bi bi-file-earmark-text d-none fs-4"></span>
          <span class="sidebar-nav-text d-none d-md-inline">
            博客
          </span>
          </a><a
            href="https://huangweiran.club/zh/"
            class="sidebar-nav-item list-group-item list-group-item-action border border-0"
            data-bs-toggle="tooltip" data-bs-title="作者"
          >
          <span class="sidebar-nav-icon bi bi-person d-none fs-4"></span>
          <span class="sidebar-nav-text d-none d-md-inline">
            作者
          </span>
          </a><a
            href="https://huangweiran.club/online-cv/"
            class="sidebar-nav-item list-group-item list-group-item-action border border-0"
            data-bs-toggle="tooltip" data-bs-title="关于"
          >
          <span class="sidebar-nav-icon bi bi-question-octagon d-none fs-4"></span>
          <span class="sidebar-nav-text d-none d-md-inline">
            关于
          </span>
          </a><a
            href="https://huangweiran.club/LifeCalendar/"
            class="sidebar-nav-item list-group-item list-group-item-action border border-0"
            data-bs-toggle="tooltip" data-bs-title="日历"
          >
          <span class="sidebar-nav-icon bi bi-calendar-date d-none fs-4"></span>
          <span class="sidebar-nav-text d-none d-md-inline">
            日历
          </span>
          </a><a
            href="https://huangweiran.club/Projects/"
            class="sidebar-nav-item list-group-item list-group-item-action border border-0"
            data-bs-toggle="tooltip" data-bs-title="项目"
          >
          <span class="sidebar-nav-icon bi bi-code-slash d-none fs-4"></span>
          <span class="sidebar-nav-text d-none d-md-inline">
            项目
          </span>
          </a></div>

      <div class="sidebar-social d-none d-md-block mt-4 pb-4 px-4">
        <div class="container-fluid">
          <div class="row justify-content-center">
            <div class="col-auto px-2">
        <a
          href="mailto:huangweiran1998@outlook.com"
          target="_blank" rel="noopener noreferrer"
          data-bs-toggle="tooltip"
          data-bs-title='Email'
          class="text-decoration-none"
        >
          <span class="bi bi-envelope-fill"></span>
        </a>
      </div><div class="col-auto px-2">
        <a
          href="https://github.com/EtoDemerzel0427"
          target="_blank" rel="noopener noreferrer"
          data-bs-toggle="tooltip"
          data-bs-title='GitHub'
          class="text-decoration-none"
        >
          <span class="bi bi-github"></span>
        </a>
      </div><div class="col-auto px-2">
        <a
          href="https://www.linkedin.com/in/weiranhuang"
          target="_blank" rel="noopener noreferrer"
          data-bs-toggle="tooltip"
          data-bs-title='LinkedIn'
          class="text-decoration-none"
        >
          <span class="bi bi-linkedin"></span>
        </a>
      </div><div class="col-auto px-2">
        <a
          href="https://www.facebook.com/profile.php?id=100006603762815"
          target="_blank" rel="noopener noreferrer"
          data-bs-toggle="tooltip"
          data-bs-title='Facebook'
          class="text-decoration-none"
        >
          <span class="bi bi-facebook"></span>
        </a>
      </div><div class="col-auto px-2">
        <a
          href="https://www.instagram.com/etodemerzel0427"
          target="_blank" rel="noopener noreferrer"
          data-bs-toggle="tooltip"
          data-bs-title='Instagram'
          class="text-decoration-none"
        >
          <span class="bi bi-instagram"></span>
        </a>
      </div><div class="col-auto px-2">
        <a
          href="https://psnprofiles.com/eto-demerzel0427"
          target="_blank" rel="noopener noreferrer"
          data-bs-toggle="tooltip"
          data-bs-title='Playstation'
          class="text-decoration-none"
        >
          <span class="bi bi-playstation"></span>
        </a>
      </div>
          </div>
        </div>
      </div>
    </aside>
  </div><div class="col mh-100 overflow-auto px-0"><nav
    class="navbar navbar-expand navbar-bg-light sticky-top border-bottom"
  >
    <div class="container-fluid"><button
        type="button"
        class="btn d-block d-lg-none fs-5"
        data-bs-toggle="offcanvas" data-bs-target="#offcanvas"
        aria-controls="offcanvas"
      >
        <span class="bi bi-list"></span>
      </button>
      
      <div class="col-8">
        
          <div class="row justify-content-center justify-content-lg-start p-2 ps-xl-3 text-center"><div class="col-auto d-none d-xl-block">
        <a
          href="https://huangweiran.club/zh/blog/"
          class="text-decoration-none"
        >
          博客
        </a>
      </div>
      <div class="col-auto d-none d-xl-block">
        <span class="text-secondary">
          »
        </span>
      </div><div class="col-auto">
      <span
        class="d-inline d-sm-none text-secondary"
        data-bs-toggle="tooltip"
        data-bs-title="浅谈C++ auto"
      >
        浅谈C++ auto
      </span>
      <span
        class="d-none d-sm-inline text-secondary"
        data-bs-toggle="tooltip"
        data-bs-title="浅谈C++ auto"
      >
        浅谈C++ auto
      </span>
    </div>
  </div>
        
      </div>

      <!-- Add language toggle button here -->
      
      <div class="d-flex ms-auto">
        <button type="button" class="btn btn-link border-0 text-dark" id="language-toggler">
    <i class="bi bi-globe2 fs-5 fs-md-4 fs-lg-5"></i>
  </button>
        <button
    type="button" data-bs-toggle="modal" data-bs-target="#searchModal"
    class="btn border border-0"
  >
    <span class="bi bi-search fs-5"></span>
  </button>
      </div>
    </div>
  </nav><div class="d-flex flex-column h-100"><main class="container">
    <div class="row justify-content-center mt-5">
      <div class="col-11 col-lg-10 col-xxl-9">
        <h1 class="mb-3">
          浅谈C++ auto
        </h1>
        <div class="row mt-3 mb-2">
          <div class="col-auto">
            <small class="text-muted">
              By:
              <a
                href="https://huangweiran.club/"
                target="_blank" rel="noopener noreferrer"
                class="text-decoration-none"
              >
                Weiran Huang
              </a>
            </small>
          </div>
        </div>
        <div class="row mb-3">
          <div class="col-auto mb-2">
            <small class="text-muted">
              Posted:
              <time datetime="2024-10-23T22:24:00-05:00">
                <a 
                  href="#" data-bs-toggle="tooltip"
                  data-bs-title="Wednesday, October 23, 2024 10:24:00 PM -05:00"
                  class="text-muted text-decoration-none"
                >
                  October 23, 2024
                </a>
              </time>
            </small>
          </div>
          
        </div><div class="mb-5">
          <p><code>auto</code> 这个关键字其实早在C语言中就存在，彼时它的语义是指示变量具有<a rel="noopener nofollow noreferrer" target="_blank" href="https://en.cppreference.com/w/cpp/language/storage_duration">自动存储期（automatic storage duration）</a>，即变量在进入其声明所在的代码块时被创建，并在离开该代码块时自动销毁。但由于这本就是局部变量的默认行为，所以几乎没有人使用它。因此C++之父Bjarne Stroustrup在C++11中巧妙地借用了这个既存的关键字，并赋予它新的含义，自动类型推导（<strong>auto</strong>matic type deduction）。<code>auto</code> 在处理复杂类型（如各种iterator）以及那些难以甚至无法写出确切类型的变量（如lambda）时非常有用。</p>
<!--more-->
<h2 id="ji-ben-yu-fa">基本语法</h2>
<p><code>auto</code>关键字允许编译器根据初始化表达式自动推导变量的类型。以下是一些基本用法示例：</p>
<ol>
<li>直接通过值推导：<pre data-lang="cpp" class="language-cpp z-code"><code class="language-cpp" data-lang="cpp"><span class="z-source z-c++"><span class="z-storage z-type z-c">auto</span> x <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-constant z-numeric z-float z-decimal z-c++">3<span class="z-punctuation z-separator z-decimal z-c++">.</span>14</span><span class="z-punctuation z-terminator z-c++">;</span> <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> x 的类型为 double
</span><span class="z-storage z-type z-c">auto</span> y <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-constant z-numeric z-integer z-decimal z-c++">42</span><span class="z-punctuation z-terminator z-c++">;</span>   <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> y 的类型为 int
</span><span class="z-storage z-type z-c">auto</span> <span class="z-meta z-function z-c++"><span class="z-meta z-toc-list z-full-identifier z-c++"><span class="z-entity z-name z-function z-c++">z</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-constant z-numeric z-integer z-decimal z-c++">1</span><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>     <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> z 的类型为 int
</span></span></code></pre>
</li>
<li>根据表达式推导：<pre data-lang="cpp" class="language-cpp z-code"><code class="language-cpp" data-lang="cpp"><span class="z-source z-c++"><span class="z-storage z-type z-c">int</span> <span class="z-meta z-function z-c++"><span class="z-meta z-toc-list z-full-identifier z-c++"><span class="z-entity z-name z-function z-c++">foo</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
<span class="z-storage z-type z-c">auto</span> x1 <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">foo</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span> <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> x1 : int
</span></span></code></pre>
</li>
<li>含有cv限定符、引用或指针的推导：<pre data-lang="cpp" class="language-cpp z-code"><code class="language-cpp" data-lang="cpp"><span class="z-source z-c++"><span class="z-storage z-modifier z-c++">const</span> <span class="z-storage z-type z-c">auto</span><span class="z-keyword z-operator z-c++">&amp;</span> x2 <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">foo</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span> <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> x2 : const int&amp; 
</span><span class="z-storage z-type z-c">auto</span><span class="z-keyword z-operator z-c++">&amp;</span> x3 <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">foo</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span> <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> x3 : int&amp; - 错误，不能将引用绑定到临时对象
</span>
<span class="z-storage z-type z-c">float</span><span class="z-keyword z-operator z-c++">&amp;</span> <span class="z-meta z-function z-c++"><span class="z-meta z-toc-list z-full-identifier z-c++"><span class="z-entity z-name z-function z-c++">bar</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
<span class="z-storage z-type z-c">auto</span> y1 <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">bar</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span> <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> y1 : float
</span><span class="z-storage z-modifier z-c++">const</span> <span class="z-storage z-type z-c">auto</span><span class="z-keyword z-operator z-c++">&amp;</span> y2 <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">bar</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span> <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> y2 : const float&amp; 
</span><span class="z-storage z-type z-c">auto</span><span class="z-keyword z-operator z-c++">&amp;</span> y3 <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">bar</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span> <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> y3 : float&amp;
</span>
A<span class="z-keyword z-operator z-c++">*</span> <span class="z-meta z-function z-c++"><span class="z-meta z-toc-list z-full-identifier z-c++"><span class="z-entity z-name z-function z-c++">fii</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
<span class="z-storage z-type z-c">auto</span><span class="z-keyword z-operator z-c++">*</span> z1 <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">fii</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span> <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> z1 : A*
</span><span class="z-storage z-type z-c">auto</span> z2 <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">fii</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span> <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> z2 : A*
</span><span class="z-storage z-type z-c">auto</span><span class="z-keyword z-operator z-c++">*</span> z3 <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">bar</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span> <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> 错误，bar 不返回指针类型
</span></span></code></pre>
从上面几个例子里，<code>auto</code>的类型推导规则已经初见端倪，我们将在下一节具体介绍。
而一个略微偏题但值得注意的情形是，const引用可以绑定到临时对象上（<code>const auto&amp; x2 = foo()</code>），而非const引用则不行。从语义上说，修改临时对象本身就没有意义；从生命周期上说，如果允许非const引用绑定到临时对象，那么在临时对象销毁后，引用将变成悬空引用（dangling reference），而const引用会延长临时对象的生命周期，使其与引用的生命周期相同<sup id="a1"><a href="https://huangweiran.club/zh/blog/cpp-auto/#f1">1</a></sup>。</li>
<li>多变量声明：<pre data-lang="cpp" class="language-cpp z-code"><code class="language-cpp" data-lang="cpp"><span class="z-source z-c++"><span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> 多变量声明
</span><span class="z-storage z-type z-c">auto</span> a <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-constant z-numeric z-integer z-decimal z-c++">1</span><span class="z-punctuation z-separator z-c++">,</span> <span class="z-keyword z-operator z-c">*</span>b <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-keyword z-operator z-c">&amp;</span>a<span class="z-punctuation z-terminator z-c++">;</span> <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> 有效，声明从左到右处理
</span><span class="z-storage z-type z-c">auto</span> x <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-constant z-numeric z-integer z-decimal z-c++">1</span><span class="z-punctuation z-separator z-c++">,</span> <span class="z-keyword z-operator z-c">*</span>y <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-keyword z-operator z-c">&amp;</span>x<span class="z-punctuation z-terminator z-c++">;</span> <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> 同样有效，因为声明是从左到右处理的
</span><span class="z-storage z-type z-c">auto</span> m <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-constant z-numeric z-integer z-decimal z-c++">1</span><span class="z-punctuation z-separator z-c++">,</span> y <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-constant z-numeric z-float z-decimal z-c++">3<span class="z-punctuation z-separator z-decimal z-c++">.</span>14</span><span class="z-punctuation z-terminator z-c++">;</span> <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> 报错，因为类型不统一
</span></span></code></pre>
在多变量声明中，<code>auto</code> 的类型由第一个声明推导而来，后续声明必须与此兼容，这是因为声明是从左到右处理的。</li>
<li>在动态分配中使用：<pre data-lang="cpp" class="language-cpp z-code"><code class="language-cpp" data-lang="cpp"><span class="z-source z-c++"><span class="z-storage z-type z-c">auto</span><span class="z-keyword z-operator z-c++">*</span> p <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-keyword z-control z-c++">new</span> <span class="z-storage z-type z-c">auto</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span><span class="z-constant z-numeric z-integer z-decimal z-c++">1</span><span class="z-punctuation z-section z-group z-end z-c++">)</span></span><span class="z-punctuation z-terminator z-c++">;</span>  <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> 在动态分配中使用 auto
</span></span></code></pre>
这是一个不常见单确实合法的语法。</li>
</ol>
<h2 id="lei-xing-tui-dao-gui-ze">类型推导规则</h2>
<blockquote>
<p>本节涉及的代码可以在<a rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/EtoDemerzel0427/LangLawyer/blob/main/auto-deduce.cpp">这里</a>查看。</p>
</blockquote>
<p>auto的类型推导规则实际上与模板参数推导规则是一致的。这意味着，对于：</p>
<pre data-lang="cpp" class="language-cpp z-code"><code class="language-cpp" data-lang="cpp"><span class="z-source z-c++"><span class="z-meta z-template z-c++"><span class="z-storage z-type z-template z-c++">template</span><span class="z-punctuation z-section z-generic z-begin z-c++">&lt;</span></span><span class="z-meta z-template z-c++"><span class="z-storage z-type z-c++">typename</span> T</span><span class="z-meta z-template z-c++"><span class="z-punctuation z-section z-generic z-end z-c++">&gt;</span></span>
<span class="z-storage z-type z-c">void</span> <span class="z-meta z-function z-c++"><span class="z-meta z-toc-list z-full-identifier z-c++"><span class="z-entity z-name z-function z-c++">foo</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++">T <span class="z-variable z-parameter z-c++">param</span><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>

<span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">foo</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++">expr</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>    <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> 推导T的过程
</span><span class="z-storage z-type z-c">auto</span> x <span class="z-keyword z-operator z-assignment z-c">=</span> expr<span class="z-punctuation z-terminator z-c++">;</span> <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> 推导x的类型的过程
</span></span></code></pre>
<p><code>foo(expr)</code>推导模板参数<code>T</code>的过程，与<code>auto x = expr</code>中推导<code>x</code>类型的过程遵循相同的规则，这个规则主要分为以下三种情形：</p>
<ul>
<li>
<p><strong>声明形式为 <code>auto x = expr</code></strong>：</p>
<ol>
<li>忽略expr的引用性</li>
<li>忽略expr的top-level cv限定符</li>
<li>数组退化为指针</li>
<li>函数退化为函数指针</li>
</ol>
<pre data-lang="cpp" class="language-cpp z-code"><code class="language-cpp" data-lang="cpp"><span class="z-source z-c++"><span class="z-storage z-modifier z-c++">const</span> <span class="z-storage z-type z-c">int</span> a <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-constant z-numeric z-integer z-decimal z-c++">42</span><span class="z-punctuation z-terminator z-c++">;</span>
<span class="z-storage z-type z-c">auto</span> b <span class="z-keyword z-operator z-assignment z-c">=</span> a<span class="z-punctuation z-terminator z-c++">;</span>      <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> b的类型为int，const被擦除
</span>
<span class="z-storage z-modifier z-c++">const</span> <span class="z-storage z-type z-c">int</span><span class="z-keyword z-operator z-c++">&amp;</span> c <span class="z-keyword z-operator z-assignment z-c">=</span> a<span class="z-punctuation z-terminator z-c++">;</span>
<span class="z-storage z-type z-c">auto</span> d <span class="z-keyword z-operator z-assignment z-c">=</span> c<span class="z-punctuation z-terminator z-c++">;</span>      <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> d的类型为int，const和引用都擦除
</span>
<span class="z-storage z-type z-c">int</span> arr<span class="z-meta z-brackets z-c++"><span class="z-punctuation z-section z-brackets z-begin z-c++">[</span><span class="z-constant z-numeric z-integer z-decimal z-c++">10</span><span class="z-punctuation z-section z-brackets z-end z-c++">]</span></span><span class="z-punctuation z-terminator z-c++">;</span>
<span class="z-storage z-type z-c">auto</span> e <span class="z-keyword z-operator z-assignment z-c">=</span> arr<span class="z-punctuation z-terminator z-c++">;</span>    <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> e的类型为int*，数组退化为指针
</span>
<span class="z-storage z-type z-c">void</span> <span class="z-meta z-function z-c++"><span class="z-meta z-toc-list z-full-identifier z-c++"><span class="z-entity z-name z-function z-c++">foo</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
<span class="z-storage z-type z-c">auto</span> f <span class="z-keyword z-operator z-assignment z-c">=</span> foo<span class="z-punctuation z-terminator z-c++">;</span>    <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> f的类型为void(*)()，函数退化为函数指针
</span></span></code></pre>
</li>
<li>
<p><strong>声明形式为 <code>auto&amp; x = expr</code> （引用推导）</strong>。首先毫无疑问，x的类型是引用，而其引用的类型的推导规则是：</p>
<ol>
<li>保留expr的cv限定符</li>
<li>如果expr本身是引用，则使用其引用的底层类型</li>
<li>不发生数组或函数退化</li>
</ol>
<pre data-lang="cpp" class="language-cpp z-code"><code class="language-cpp" data-lang="cpp"><span class="z-source z-c++"><span class="z-storage z-modifier z-c++">const</span> <span class="z-storage z-type z-c">int</span> a <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-constant z-numeric z-integer z-decimal z-c++">42</span><span class="z-punctuation z-terminator z-c++">;</span>
<span class="z-storage z-type z-c">auto</span><span class="z-keyword z-operator z-c++">&amp;</span> b <span class="z-keyword z-operator z-assignment z-c">=</span> a<span class="z-punctuation z-terminator z-c++">;</span>     <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> b的类型为const int&amp;
</span>
<span class="z-storage z-type z-c">int</span><span class="z-keyword z-operator z-c++">&amp;</span> c <span class="z-keyword z-operator z-assignment z-c">=</span> a<span class="z-punctuation z-terminator z-c++">;</span>
<span class="z-storage z-type z-c">auto</span><span class="z-keyword z-operator z-c++">&amp;</span> d <span class="z-keyword z-operator z-assignment z-c">=</span> c<span class="z-punctuation z-terminator z-c++">;</span>     <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> d的类型为int&amp;
</span>
<span class="z-storage z-type z-c">int</span> arr<span class="z-meta z-brackets z-c++"><span class="z-punctuation z-section z-brackets z-begin z-c++">[</span><span class="z-constant z-numeric z-integer z-decimal z-c++">10</span><span class="z-punctuation z-section z-brackets z-end z-c++">]</span></span><span class="z-punctuation z-terminator z-c++">;</span>
<span class="z-storage z-type z-c">auto</span><span class="z-keyword z-operator z-c++">&amp;</span> e <span class="z-keyword z-operator z-assignment z-c">=</span> arr<span class="z-punctuation z-terminator z-c++">;</span>    <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> e的类型为int(&amp;)[10]
</span>
<span class="z-storage z-type z-c">void</span> <span class="z-meta z-function z-c++"><span class="z-meta z-toc-list z-full-identifier z-c++"><span class="z-entity z-name z-function z-c++">foo</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
<span class="z-storage z-type z-c">auto</span><span class="z-keyword z-operator z-c++">&amp;</span> f <span class="z-keyword z-operator z-assignment z-c">=</span> foo<span class="z-punctuation z-terminator z-c++">;</span>    <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> f的类型为void(&amp;)()
</span></span></code></pre>
</li>
<li>
<p><strong>声明形式为 <code>auto&amp;&amp; x = expr</code> （通用引用推导）</strong></p>
<p>这种情形要复杂一些。首先，<code>auto&amp;&amp;</code>（或者模板参数推导中的<code>T&amp;&amp;</code>），是一种通用引用（universal reference），它允许用于匹配的表达式是左值或右值。在类型推导时:</p>
<ol>
<li>如果<code>expr</code>是左值（假设其类型为<code>param_t</code>)，<code>auto</code>被推导为左值引用类型，即<code>param_t&amp;</code>；</li>
<li>如果expr是右值，auto被推导为非引用类型，即<code>param_t</code>（规则与 <code>auto&amp; x = expr</code> 相同）。</li>
<li>在这之后，在编译器把推导出来的类型带入到<code>auto&amp;&amp;</code>或<code>T&amp;&amp;</code>中时（不妨想我们这时候获得的<em>形式上</em>的类型是<code>param_t&amp; &amp;&amp;</code>或<code>param_t&amp;&amp;</code>），会发生引用折叠（reference collapsing）。引用折叠的规则其实很简单， 如果我们把折叠前的类型看作引用的引用，那引用折叠的规则是：<strong>如果这两个引用中至少有一个是左值引用，那么折叠后的类型是左值引用，否则是右值引用。</strong> 也就是说，<code>T&amp;&amp; &amp;&amp;</code>折叠为<code>T&amp;&amp;</code>，<code>T&amp; &amp;&amp;</code>折叠为<code>T&amp;</code>，<code>T&amp;&amp; &amp;</code>折叠为<code>T&amp;</code>，<code>T&amp; &amp;</code>折叠为<code>T&amp;</code>（后两种情形不会出现在<code>auto&amp;&amp;</code>的推导中）。</li>
</ol>
<pre data-lang="cpp" class="language-cpp z-code"><code class="language-cpp" data-lang="cpp"><span class="z-source z-c++"><span class="z-storage z-type z-c">int</span> a <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-constant z-numeric z-integer z-decimal z-c++">42</span><span class="z-punctuation z-terminator z-c++">;</span>
<span class="z-storage z-type z-c">auto</span><span class="z-keyword z-operator z-c++">&amp;</span><span class="z-keyword z-operator z-c++">&amp;</span> b <span class="z-keyword z-operator z-assignment z-c">=</span> a<span class="z-punctuation z-terminator z-c++">;</span>     <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> a 是左值，auto推导为int&amp;，形式为int&amp; &amp;&amp;，折叠为int&amp;
</span>
<span class="z-storage z-type z-c">int</span><span class="z-keyword z-operator z-c++">&amp;</span><span class="z-keyword z-operator z-c++">&amp;</span> rref <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-constant z-numeric z-integer z-decimal z-c++">42</span><span class="z-punctuation z-terminator z-c++">;</span>     <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> rref是个右值引用，但它本身是个左值
</span><span class="z-storage z-type z-c">auto</span><span class="z-keyword z-operator z-c++">&amp;</span><span class="z-keyword z-operator z-c++">&amp;</span> r <span class="z-keyword z-operator z-assignment z-c">=</span> rref<span class="z-punctuation z-terminator z-c++">;</span>     <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> auto推导为int&amp;，形式为int&amp; &amp;&amp;，折叠为int&amp;
</span>
<span class="z-storage z-type z-c">auto</span><span class="z-keyword z-operator z-c++">&amp;</span><span class="z-keyword z-operator z-c++">&amp;</span> c <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-constant z-numeric z-integer z-decimal z-c++">42</span><span class="z-punctuation z-terminator z-c++">;</span>     <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> 42是右值，auto推导为int，形式为int&amp;&amp;，折叠保持不变，仍为int&amp;&amp;
</span>
<span class="z-storage z-type z-c">auto</span><span class="z-keyword z-operator z-c++">&amp;</span><span class="z-keyword z-operator z-c++">&amp;</span> d <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-meta z-function-call z-c++">std<span class="z-punctuation z-accessor z-double-colon z-c++">::</span><span class="z-variable z-function z-c++">move</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++">a</span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>  <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> std::move(a)是右值，auto推导为int，形式为int&amp;&amp; &amp;&amp;，折叠为int&amp;&amp;
</span></span></code></pre>
</li>
</ul>
<h2 id="xiang-guan-yue-du">相关阅读</h2>
<ul>
<li><em>Effective Modern C++</em> by Scott Meyers, Item 2: Understand auto type deduction.</li>
<li>cppreference.com, <a rel="noopener nofollow noreferrer" target="_blank" href="https://en.cppreference.com/w/cpp/language/auto">auto specifier</a>.</li>
</ul>
<h2 id="pang-zhu">旁注</h2>
<div id="f1">
  <sup>[1]</sup> 
  对于类的成员引用，编译器无法确定如何将临时对象的生命周期安全地延长到整个类对象的生命周期。
  因此：
<pre data-lang="cpp" class="language-cpp z-code"><code class="language-cpp" data-lang="cpp"><span class="z-source z-c++">  <span class="z-meta z-struct z-c++"><span class="z-storage z-type z-c++">struct</span> </span><span class="z-meta z-struct z-c++"><span class="z-entity z-name z-struct z-c++">S</span></span><span class="z-meta z-struct z-c++"> <span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-begin z-c++">{</span></span></span><span class="z-meta z-struct z-c++"><span class="z-meta z-block z-c++">
      <span class="z-storage z-modifier z-c++">const</span> <span class="z-storage z-type z-c">int</span><span class="z-keyword z-operator z-c++">&amp;</span> ref<span class="z-punctuation z-terminator z-c++">;</span>
      <span class="z-meta z-method z-constructor z-c++"><span class="z-entity z-name z-function z-constructor z-c++">S</span></span><span class="z-meta z-method z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-method z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-meta z-method z-c++"> </span><span class="z-meta z-method z-constructor z-initializer-list z-c++"><span class="z-punctuation z-separator z-initializer-list z-c++">:</span> <span class="z-variable z-other z-readwrite z-member z-c++">ref</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span><span class="z-meta z-group z-c++"><span class="z-constant z-numeric z-integer z-decimal z-c++">42</span></span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span> </span><span class="z-meta z-method z-c++"><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-begin z-c++">{</span></span></span><span class="z-meta z-method z-c++"><span class="z-meta z-block z-c++"> </span></span><span class="z-meta z-method z-c++"><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-end z-c++">}</span></span></span>  <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> 危险：成员引用绑定到临时对象
</span>  </span></span><span class="z-meta z-struct z-c++"><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-end z-c++">}</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>  <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> 临时对象在构造函数结束时被销毁
</span></span></code></pre>
<p>是错误的。<a href="#a1">↩</a></p>
</div>

        </div>
        
        
      </div>
    </div>
  </main><div class="container">
    <div class="row justify-content-center mt-3 mb-4">
      <div class="col-11 col-lg-10 col-xxl-9"><div id="disqus_thread"></div>
  <script>        
    var disqus_config = function () {
      this.page.url = 'https://huangweiran.club/zh/blog/cpp-auto/';  

      this.page.identifier = 'cpp-auto'; 
    };
    
    (function() {
      var d = document, s = d.createElement('script');
      
      s.src = 'https://user.disqus.com/embed.js';
      
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>
    Please enable JavaScript to view the 
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">
      comments powered by Disqus.
    </a>
  </noscript></div>
    </div>
  </div><footer class="container-fluid mt-auto">
    <div class="row justify-content-center">
      <div class="col-10">
        <div class="row pt-3 pb-4 border-top">
          <div class="col-12 col-md-6 mb-2 mb-md-0 text-center text-md-start">
            <small class="text-secondary">
              © 2024
              <a 
                href="https://huangweiran.club/"
                target="_blank" rel="noopener noreferrer"
                class="text-decoration-none"
              >
                Weiran Huang&period;
              </a>
              <a
                href="https://creativecommons.org/licenses/by/4.0/"
                data-bs-toggle="tooltip"
                data-bs-title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
                class="text-secondary text-decoration-none"
              >
                Some rights reserved.
              </a>
            </small>
          </div>
          <div class="col-12 col-md-6 text-center text-md-end">
            <small class="text-secondary">
              Powered by
              <a 
                href="https://www.getzola.org/"
                target="_blank" rel="noopener noreferrer"
                class="text-decoration-none"
              >
                Zola
              </a>
              with
              <a 
                href="https://github.com/gersonbdev/ataraxia-zola"
                target="_blank" rel="noopener noreferrer"
                class="text-decoration-none"
              >
                Ataraxia
              </a>
              theme.
            </small>
          </div>
        </div>
      </div>
    </div>
  </footer>
        </div>
      </div>
    </div>
  </div>
  <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvas" aria-labelledby="offcanvasLabel">
    <div class="offcanvas-body p-0">
      <div class="sidebar container-fluid vh-100">
        <div class="row h-100">
          <div
            class="col mh-100 px-0 overflow-auto"
          >
            <aside class="d-flex flex-column justify-content-between h-100">
              <div class="mb-4 pt-5 px-3 text-center">
                <div class="sidebar-avatar mb-2 mx-auto border border-3 rounded-circle">
                  <a href="https://huangweiran.club/" target="_blank" rel="noopener noreferrer">
    <img
      src="https://i.pinimg.com/736x/e7/d3/b6/e7d3b63a28a976d061696af520f80ee8.jpg"
      alt="Weiran Huang"
      class="img-fluid"
    >
  </a>
                </div>
                <div>
                  <a
                    href="https://huangweiran.club/"
                    class="sidebar-title fs-5 fw-bold text-decoration-none"
                  >
                    我的川陀
                  </a>
                </div>
              </div>

              <div class="sidebar-nav list-group my-auto rounded-0 text-start"><a
            href="https://huangweiran.club/zh/"
            class="sidebar-nav-item list-group-item list-group-item-action border border-0"
            data-bs-toggle="tooltip" data-bs-title="主页"
          >
          <span class="sidebar-nav-icon bi bi-house ms-2 me-1 fs-4"></span>
          <span class="sidebar-nav-text">主页</span>
          </a><a
            href="https://huangweiran.club/zh/blog/"
            class="sidebar-nav-item list-group-item list-group-item-action border border-0"
            data-bs-toggle="tooltip" data-bs-title="博客"
          >
          <span class="sidebar-nav-icon bi bi-file-earmark-text ms-2 me-1 fs-4"></span>
          <span class="sidebar-nav-text">博客</span>
          </a><a
            href="https://huangweiran.club/zh/"
            class="sidebar-nav-item list-group-item list-group-item-action border border-0"
            data-bs-toggle="tooltip" data-bs-title="作者"
          >
          <span class="sidebar-nav-icon bi bi-person ms-2 me-1 fs-4"></span>
          <span class="sidebar-nav-text">作者</span>
          </a><a
            href="https://huangweiran.club/online-cv/"
            class="sidebar-nav-item list-group-item list-group-item-action border border-0"
            data-bs-toggle="tooltip" data-bs-title="关于"
          >
          <span class="sidebar-nav-icon bi bi-question-octagon ms-2 me-1 fs-4"></span>
          <span class="sidebar-nav-text">关于</span>
          </a><a
            href="https://huangweiran.club/LifeCalendar/"
            class="sidebar-nav-item list-group-item list-group-item-action border border-0"
            data-bs-toggle="tooltip" data-bs-title="日历"
          >
          <span class="sidebar-nav-icon bi bi-calendar-date ms-2 me-1 fs-4"></span>
          <span class="sidebar-nav-text">日历</span>
          </a><a
            href="https://huangweiran.club/Projects/"
            class="sidebar-nav-item list-group-item list-group-item-action border border-0"
            data-bs-toggle="tooltip" data-bs-title="项目"
          >
          <span class="sidebar-nav-icon bi bi-code-slash ms-2 me-1 fs-4"></span>
          <span class="sidebar-nav-text">项目</span>
          </a></div>

              <div class="sidebar-social mt-4 pb-4 px-3">
                <div class="container-fluid">
                  <div class="row justify-content-center">
                    <div class="col-auto px-2">
        <a
          href="mailto:huangweiran1998@outlook.com"
          target="_blank" rel="noopener noreferrer"
          data-bs-toggle="tooltip"
          data-bs-title='Email'
          class="text-decoration-none"
        >
          <span class="bi bi-envelope-fill"></span>
        </a>
      </div><div class="col-auto px-2">
        <a
          href="https://github.com/EtoDemerzel0427"
          target="_blank" rel="noopener noreferrer"
          data-bs-toggle="tooltip"
          data-bs-title='GitHub'
          class="text-decoration-none"
        >
          <span class="bi bi-github"></span>
        </a>
      </div><div class="col-auto px-2">
        <a
          href="https://www.linkedin.com/in/weiranhuang"
          target="_blank" rel="noopener noreferrer"
          data-bs-toggle="tooltip"
          data-bs-title='LinkedIn'
          class="text-decoration-none"
        >
          <span class="bi bi-linkedin"></span>
        </a>
      </div><div class="col-auto px-2">
        <a
          href="https://www.facebook.com/profile.php?id=100006603762815"
          target="_blank" rel="noopener noreferrer"
          data-bs-toggle="tooltip"
          data-bs-title='Facebook'
          class="text-decoration-none"
        >
          <span class="bi bi-facebook"></span>
        </a>
      </div><div class="col-auto px-2">
        <a
          href="https://www.instagram.com/etodemerzel0427"
          target="_blank" rel="noopener noreferrer"
          data-bs-toggle="tooltip"
          data-bs-title='Instagram'
          class="text-decoration-none"
        >
          <span class="bi bi-instagram"></span>
        </a>
      </div><div class="col-auto px-2">
        <a
          href="https://psnprofiles.com/eto-demerzel0427"
          target="_blank" rel="noopener noreferrer"
          data-bs-toggle="tooltip"
          data-bs-title='Playstation'
          class="text-decoration-none"
        >
          <span class="bi bi-playstation"></span>
        </a>
      </div>
                  </div>
                </div>
              </div>
            </aside>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="searchModalLabel">
          Search
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div
          id="searchInput" role="search" 
          class="d-flex mb-3 border rounded-5 bg-white"
        >
          <input
            id="search" type="search"
            class="form-control border border-0 rounded-5 rounded-end"
            placeholder="Search"
            aria-label="Search"
          >
          <div class="rounded-5 rounded-start py-2 ps-2 pe-3">
            <span class="bi bi-search"></span>
          </div>
        </div>
        <div class="search-results">
          <div class="search-results__items">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
  <script src="https://huangweiran.club/assets/js/bootstrap/bootstrap.bundle.min.js"></script>
  <script>
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
    const myModal = document.getElementById('searchModal');
    const myInput = document.getElementById('searchInput');

    myModal.addEventListener('shown.bs.modal', () => {
      myInput.focus()
    });
  </script>
  <script>
    hljs.highlightAll();
    hljs.addPlugin(new CopyButtonPlugin());
</script>
  <script>
    function toggleLanguage() {
        const currentUrl = new URL(window.location.href);
        const pathSegments = currentUrl.pathname.split('/').filter(segment => segment);
        
        if (pathSegments[0] === 'zh') {
            pathSegments.shift();
        } else {
            pathSegments.unshift('zh');
        }
        
        currentUrl.pathname = '/' + pathSegments.join('/');
        window.location.href = currentUrl.href;
    }
    
    document.addEventListener('DOMContentLoaded', function () {
        document.getElementById('language-toggler').addEventListener('click', toggleLanguage);
    });
  </script>
  const lang = document.documentElement.lang;
  console.log(lang);
  <script src="https://huangweiran.club/elasticlunr.min.js"></script><script src="https://huangweiran.club/search_index.zh.js"></script>
    <script src="https://huangweiran.club/assets/js/search/lunr.stemmer.support.min.js"></script>
    <script src="https://huangweiran.club/assets/js/search/lunr.zh.min.js"></script><script src="https://huangweiran.club/assets/js/search/search.js"></script>
</body>
</html>