
---
import Layout from '../../../layouts/Layout.astro';
import BlogList from '../../../components/react-pages/BlogList';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
    const allPosts = await getCollection('posts');
    const posts = allPosts.map(p => ({
        slug: p.slug,
        ...p.data
    })).sort((a, b) => new Date(b.date) - new Date(a.date));
    
    const uniqueTags = [...new Set(posts.flatMap(post => post.tags || []))];

    return uniqueTags.map(tag => {
        const filteredPosts = posts.filter(post => post.tags && post.tags.includes(tag));
        return {
            params: { tag },
            props: { posts: filteredPosts, tag },
        };
    });
}

const { posts, tag } = Astro.props;
---

<Layout title={`Tag: ${tag} | Weiran's Universe`}>
    <BlogList client:only="react" posts={posts} activeTag={tag} />
</Layout>
